name: Build Qt Android App

on: [push]

jobs:

  build:

    runs-on: windows-latest

    steps:

    - uses: actions/checkout@v2

    - name: Install Qt
      uses: jurplel/install-qt-action@v3
      with: 
        version: 6.4.0
        host: windows 
        target: android
        arch: android_arm64_v8a
        modules: qtcharts
        
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'
        distribution: 'adopt'
        
    - name: Set up Android SDK  
      uses: android-actions/setup-android@v2
      with:
        api-level: 29
        ndk-version: 21.4.7075529 # Check this matches installed NDK version
        target: x86_64

    - name: Configure CMake
      run: |
        "C:/Program Files/CMake/bin/cmake.exe" --build ${{ env.GITHUB_WORKSPACE }}/build-TestForCICD-Android_Qt_6_4_2_android_arm64_v8a_Clang_arm64_v8a-Debug --target all
    
        - name: Build with CMake  
          run: |
            cmake --build ${{ env.GITHUB_WORKSPACE }}/build --config Release
    
        # Rest of workflow for APK creation/upload
        
        
    
    - name: Create APK  
      run: |
            cd build 
            make create-apk-MyApp
    
    - name: Upload APK
      uses: actions/upload-artifact@v2
      with:
           name: MyApp.apk
           path: build/android-build/build/outputs/apk/debug/android-build-debug.apk
    